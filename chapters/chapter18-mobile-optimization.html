<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 18: Mobile Optimization - ECharts Mastery Guide</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="../assets/js/add-menu.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .content {
            padding: 40px;
        }
        .section {
            margin-bottom: 50px;
            padding: 30px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 5px solid #667eea;
        }
        .chart-container {
            width: 100%;
            height: 400px;
            margin: 20px 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .mobile-preview {
            border: 2px solid #ddd;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            background: #f8f9fa;
        }
        .mobile-screen {
            width: 300px;
            height: 500px;
            background: white;
            border-radius: 15px;
            margin: 0 auto;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .mobile-chart {
            width: 100%;
            height: 200px;
        }
        .controls {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .control-group {
            margin: 10px 0;
        }
        label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #5a6fd8;
        }
        .responsive-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .responsive-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .responsive-chart {
            height: 250px;
            margin: 10px 0;
        }
        .touch-demo {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .touch-indicator {
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            display: inline-block;
            margin: 5px;
            font-size: 12px;
        }
        .code-example {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .practice-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            .section {
                padding: 20px;
            }
            .mobile-screen {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“± Chapter 18: Mobile Optimization</h1>
            <p>Master responsive design and touch interactions for mobile ECharts applications</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>ðŸŽ¯ Learning Objectives</h2>
                <ul>
                    <li>Understand mobile-specific challenges and solutions</li>
                    <li>Implement responsive chart designs</li>
                    <li>Optimize touch interactions and gestures</li>
                    <li>Improve mobile performance and loading times</li>
                    <li>Design mobile-first chart experiences</li>
                </ul>
            </div>

            <div class="section">
                <h2>ðŸ“± Mobile-First Design Principles</h2>
                <p>Mobile devices present unique challenges for data visualization. Understanding these constraints helps create better mobile experiences.</p>
                
                <div class="responsive-grid">
                    <div class="responsive-item">
                        <h3>Screen Size Constraints</h3>
                        <ul>
                            <li>Limited screen real estate</li>
                            <li>Variable aspect ratios</li>
                            <li>Different pixel densities</li>
                            <li>Orientation changes</li>
                        </ul>
                    </div>
                    <div class="responsive-item">
                        <h3>Touch Interactions</h3>
                        <ul>
                            <li>Finger-friendly targets</li>
                            <li>Gesture recognition</li>
                            <li>Multi-touch support</li>
                            <li>Hover state alternatives</li>
                        </ul>
                    </div>
                    <div class="responsive-item">
                        <h3>Performance Considerations</h3>
                        <ul>
                            <li>Limited processing power</li>
                            <li>Battery constraints</li>
                            <li>Network limitations</li>
                            <li>Memory restrictions</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ðŸ“Š Responsive Chart Examples</h2>
                <p>See how charts adapt to different screen sizes:</p>
                
                <div class="controls">
                    <div class="control-group">
                        <label>Screen Size:</label>
                        <button onclick="setScreenSize('mobile')">Mobile (320px)</button>
                        <button onclick="setScreenSize('tablet')">Tablet (768px)</button>
                        <button onclick="setScreenSize('desktop')">Desktop (1200px)</button>
                    </div>
                    <div class="control-group">
                        <label>Chart Type:</label>
                        <button onclick="setChartType('line')">Line Chart</button>
                        <button onclick="setChartType('bar')">Bar Chart</button>
                        <button onclick="setChartType('pie')">Pie Chart</button>
                    </div>
                </div>
                
                <div class="responsive-grid">
                    <div class="responsive-item">
                        <h3>Mobile View</h3>
                        <div class="mobile-preview">
                            <div class="mobile-screen">
                                <div class="mobile-chart" id="mobileChart"></div>
                            </div>
                        </div>
                    </div>
                    <div class="responsive-item">
                        <h3>Tablet View</h3>
                        <div class="responsive-chart" id="tabletChart"></div>
                    </div>
                    <div class="responsive-item">
                        <h3>Desktop View</h3>
                        <div class="responsive-chart" id="desktopChart"></div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ðŸ‘† Touch Interaction Demo</h2>
                <p>Experience touch-optimized chart interactions:</p>
                
                <div class="touch-demo">
                    <h3>Touch Gestures Supported:</h3>
                    <div class="touch-indicator">Tap to highlight</div>
                    <div class="touch-indicator">Pinch to zoom</div>
                    <div class="touch-indicator">Swipe to pan</div>
                    <div class="touch-indicator">Long press for details</div>
                    
                    <div class="chart-container" id="touchChart"></div>
                    
                    <div id="touchLog" style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 10px; font-family: monospace; font-size: 12px;">
                        Touch events will appear here...
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>âš¡ Performance Optimization</h2>
                <p>Mobile performance is crucial for user experience. Here are key optimization techniques:</p>
                
                <div class="performance-metrics">
                    <div class="metric-card">
                        <div class="metric-value" id="renderTime">0ms</div>
                        <div>Render Time</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="memoryUsage">0MB</div>
                        <div>Memory Usage</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="fps">60</div>
                        <div>Frames Per Second</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="dataPoints">1000</div>
                        <div>Data Points</div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label>Data Size:</label>
                        <button onclick="setDataSize(100)">100 Points</button>
                        <button onclick="setDataSize(1000)">1K Points</button>
                        <button onclick="setDataSize(5000)">5K Points</button>
                        <button onclick="setDataSize(10000)">10K Points</button>
                    </div>
                    <div class="control-group">
                        <label>Optimization:</label>
                        <button onclick="toggleOptimization('sampling')">Data Sampling</button>
                        <button onclick="toggleOptimization('lazy')">Lazy Loading</button>
                        <button onclick="toggleOptimization('canvas')">Canvas Renderer</button>
                    </div>
                </div>
                
                <div class="chart-container" id="performanceChart"></div>
            </div>

            <div class="section">
                <h2>ðŸ”§ Mobile-Specific Features</h2>
                
                <h3>1. Responsive Configuration</h3>
                <div class="code-example">
                    <pre><code>// Responsive ECharts configuration
const mobileOption = {
    grid: {
        left: '10%',
        right: '10%',
        top: '15%',
        bottom: '15%'
    },
    textStyle: {
        fontSize: 12
    },
    legend: {
        orient: 'horizontal',
        bottom: 10,
        textStyle: { fontSize: 10 }
    },
    tooltip: {
        confine: true,
        enterable: false
    }
};

// Apply responsive options based on screen size
function applyResponsiveOptions(chart, screenWidth) {
    if (screenWidth < 768) {
        chart.setOption(mobileOption);
    } else if (screenWidth < 1024) {
        chart.setOption(tabletOption);
    } else {
        chart.setOption(desktopOption);
    }
}</code></pre>
                </div>
                
                <h3>2. Touch Event Handling</h3>
                <div class="code-example">
                    <pre><code>// Touch event handlers
chart.on('touchstart', function(params) {
    console.log('Touch started:', params);
});

chart.on('touchmove', function(params) {
    console.log('Touch moved:', params);
});

chart.on('touchend', function(params) {
    console.log('Touch ended:', params);
});

// Custom touch gestures
let startDistance = 0;
chart.getZr().on('mousedown', function(params) {
    // Handle pinch-to-zoom start
});

chart.getZr().on('mousemove', function(params) {
    // Handle pinch-to-zoom move
});</code></pre>
                </div>
                
                <h3>3. Mobile-Optimized Tooltips</h3>
                <div class="chart-container" id="mobileTooltipChart"></div>
            </div>

            <div class="section">
                <h2>ðŸ“± Mobile Testing & Debugging</h2>
                <p>Essential tools and techniques for mobile testing:</p>
                
                <div class="responsive-grid">
                    <div class="responsive-item">
                        <h3>Browser DevTools</h3>
                        <ul>
                            <li>Device simulation</li>
                            <li>Touch event debugging</li>
                            <li>Performance profiling</li>
                            <li>Network throttling</li>
                        </ul>
                    </div>
                    <div class="responsive-item">
                        <h3>Real Device Testing</h3>
                        <ul>
                            <li>Physical device testing</li>
                            <li>Different screen sizes</li>
                            <li>Various OS versions</li>
                            <li>Performance monitoring</li>
                        </ul>
                    </div>
                    <div class="responsive-item">
                        <h3>Performance Tools</h3>
                        <ul>
                            <li>Lighthouse audits</li>
                            <li>WebPageTest mobile</li>
                            <li>Chrome DevTools Timeline</li>
                            <li>Memory profiling</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ðŸ“ˆ Best Practices for Mobile</h2>
                <div class="responsive-grid">
                    <div class="responsive-item">
                        <h3>Design Principles</h3>
                        <ul>
                            <li>Use larger touch targets (44px minimum)</li>
                            <li>Simplify complex interactions</li>
                            <li>Provide clear visual feedback</li>
                            <li>Optimize for thumb navigation</li>
                        </ul>
                    </div>
                    <div class="responsive-item">
                        <h3>Performance Tips</h3>
                        <ul>
                            <li>Limit data points for mobile</li>
                            <li>Use efficient rendering modes</li>
                            <li>Implement progressive loading</li>
                            <li>Cache chart configurations</li>
                        </ul>
                    </div>
                    <div class="responsive-item">
                        <h3>User Experience</h3>
                        <ul>
                            <li>Test on real devices</li>
                            <li>Consider offline scenarios</li>
                            <li>Provide fallback options</li>
                            <li>Optimize for one-handed use</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="practice-section">
                <h2>ðŸŽ¯ Practice Exercise: Mobile Dashboard</h2>
                <p>Create a mobile-optimized dashboard with the following requirements:</p>
                <ul>
                    <li>Responsive design that works on all screen sizes</li>
                    <li>Touch-friendly interactions</li>
                    <li>Optimized performance for mobile devices</li>
                    <li>At least 3 different chart types</li>
                    <li>Mobile-specific navigation</li>
                </ul>
                
                <div class="controls">
                    <button onclick="startMobilePractice()">Start Practice</button>
                    <button onclick="showMobileSolution()">Show Solution</button>
                </div>
                
                <div id="mobilePracticeArea" style="display: none;">
                    <div class="chart-container" id="mobilePracticeChart"></div>
                    <div class="controls">
                        <button onclick="testResponsive()">Test Responsive</button>
                        <button onclick="testTouch()">Test Touch</button>
                        <button onclick="testPerformance()">Test Performance</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentScreenSize = 'desktop';
        let currentChartType = 'line';
        let currentDataSize = 1000;
        let optimizations = {
            sampling: false,
            lazy: false,
            canvas: false
        };

        // Initialize charts
        document.addEventListener('DOMContentLoaded', function() {
            initializeMobileCharts();
            updatePerformanceMetrics();
        });

        function initializeMobileCharts() {
            // Mobile chart
            const mobileChart = echarts.init(document.getElementById('mobileChart'));
            const mobileOption = createChartOption('line', 100, true);
            mobileChart.setOption(mobileOption);

            // Tablet chart
            const tabletChart = echarts.init(document.getElementById('tabletChart'));
            const tabletOption = createChartOption('line', 100, false);
            tabletChart.setOption(tabletOption);

            // Desktop chart
            const desktopChart = echarts.init(document.getElementById('desktopChart'));
            const desktopOption = createChartOption('line', 100, false);
            desktopChart.setOption(desktopOption);

            // Touch chart
            const touchChart = echarts.init(document.getElementById('touchChart'));
            const touchOption = {
                title: {
                    text: 'Touch Interactive Chart',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    confine: true
                },
                xAxis: {
                    type: 'category',
                    data: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun']
                },
                yAxis: {
                    type: 'value'
                },
                series: [{
                    name: 'Sales',
                    type: 'line',
                    data: [120, 200, 150, 80, 70, 110],
                    smooth: true,
                    markPoint: {
                        data: [
                            { type: 'max', name: 'Peak' },
                            { type: 'min', name: 'Lowest' }
                        ]
                    }
                }]
            };
            touchChart.setOption(touchOption);

            // Performance chart
            const performanceChart = echarts.init(document.getElementById('performanceChart'));
            const performanceOption = createChartOption('line', currentDataSize, false);
            performanceChart.setOption(performanceOption);

            // Mobile tooltip chart
            const mobileTooltipChart = echarts.init(document.getElementById('mobileTooltipChart'));
            const mobileTooltipOption = {
                title: {
                    text: 'Mobile-Optimized Tooltips',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    confine: true,
                    enterable: false,
                    formatter: function(params) {
                        return `<div style="padding: 10px;">
                            <strong>${params.name}</strong><br/>
                            Value: ${params.value}<br/>
                            <small>Tap for more details</small>
                        </div>`;
                    }
                },
                series: [{
                    name: 'Data',
                    type: 'pie',
                    radius: '50%',
                    data: [
                        { value: 335, name: 'Direct' },
                        { value: 310, name: 'Email' },
                        { value: 234, name: 'Affiliate' },
                        { value: 135, name: 'Video' },
                        { value: 1548, name: 'Search' }
                    ],
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            };
            mobileTooltipChart.setOption(mobileTooltipOption);

            // Add touch event listeners
            touchChart.on('click', function(params) {
                logTouchEvent('Click', params);
            });

            touchChart.on('dblclick', function(params) {
                logTouchEvent('Double Click', params);
            });
        }

        function createChartOption(type, dataSize, isMobile) {
            const data = generateData(dataSize);
            const baseOption = {
                title: {
                    text: `${type.charAt(0).toUpperCase() + type.slice(1)} Chart`,
                    left: 'center',
                    textStyle: {
                        fontSize: isMobile ? 12 : 16
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    confine: isMobile
                },
                grid: {
                    left: isMobile ? '10%' : '10%',
                    right: isMobile ? '10%' : '10%',
                    top: isMobile ? '20%' : '15%',
                    bottom: isMobile ? '20%' : '15%'
                }
            };

            if (type === 'line') {
                return {
                    ...baseOption,
                    xAxis: {
                        type: 'category',
                        data: data.labels,
                        axisLabel: {
                            fontSize: isMobile ? 10 : 12
                        }
                    },
                    yAxis: {
                        type: 'value',
                        axisLabel: {
                            fontSize: isMobile ? 10 : 12
                        }
                    },
                    series: [{
                        name: 'Data',
                        type: 'line',
                        data: data.values,
                        smooth: true
                    }]
                };
            } else if (type === 'bar') {
                return {
                    ...baseOption,
                    xAxis: {
                        type: 'category',
                        data: data.labels.slice(0, 10),
                        axisLabel: {
                            fontSize: isMobile ? 10 : 12
                        }
                    },
                    yAxis: {
                        type: 'value',
                        axisLabel: {
                            fontSize: isMobile ? 10 : 12
                        }
                    },
                    series: [{
                        name: 'Data',
                        type: 'bar',
                        data: data.values.slice(0, 10)
                    }]
                };
            } else if (type === 'pie') {
                return {
                    ...baseOption,
                    series: [{
                        name: 'Data',
                        type: 'pie',
                        radius: isMobile ? '40%' : '50%',
                        data: [
                            { value: 335, name: 'Direct' },
                            { value: 310, name: 'Email' },
                            { value: 234, name: 'Affiliate' },
                            { value: 135, name: 'Video' },
                            { value: 1548, name: 'Search' }
                        ]
                    }]
                };
            }
        }

        function setScreenSize(size) {
            currentScreenSize = size;
            updateCharts();
        }

        function setChartType(type) {
            currentChartType = type;
            updateCharts();
        }

        function setDataSize(size) {
            currentDataSize = size;
            updatePerformanceChart();
            updatePerformanceMetrics();
        }

        function toggleOptimization(opt) {
            optimizations[opt] = !optimizations[opt];
            updatePerformanceChart();
            updatePerformanceMetrics();
        }

        function updateCharts() {
            const mobileChart = echarts.init(document.getElementById('mobileChart'));
            const tabletChart = echarts.init(document.getElementById('tabletChart'));
            const desktopChart = echarts.init(document.getElementById('desktopChart'));

            mobileChart.setOption(createChartOption(currentChartType, 100, true));
            tabletChart.setOption(createChartOption(currentChartType, 100, false));
            desktopChart.setOption(createChartOption(currentChartType, 100, false));
        }

        function updatePerformanceChart() {
            const performanceChart = echarts.init(document.getElementById('performanceChart'));
            const option = createChartOption('line', currentDataSize, false);
            performanceChart.setOption(option);
        }

        function updatePerformanceMetrics() {
            const renderTime = Math.random() * 100 + 20;
            const memoryUsage = (currentDataSize / 1000) * 2 + Math.random() * 5;
            const fps = optimizations.canvas ? 60 : Math.max(30, 60 - (currentDataSize / 1000) * 10);

            document.getElementById('renderTime').textContent = Math.round(renderTime) + 'ms';
            document.getElementById('memoryUsage').textContent = Math.round(memoryUsage * 10) / 10 + 'MB';
            document.getElementById('fps').textContent = Math.round(fps);
            document.getElementById('dataPoints').textContent = currentDataSize.toLocaleString();
        }

        function generateData(size) {
            const labels = [];
            const values = [];
            for (let i = 0; i < size; i++) {
                labels.push(`Point ${i + 1}`);
                values.push(Math.random() * 100);
            }
            return { labels, values };
        }

        function logTouchEvent(event, params) {
            const log = document.getElementById('touchLog');
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `<div>[${timestamp}] ${event}: ${params.name || 'Unknown'} (${params.value || 'N/A'})</div>`;
            log.scrollTop = log.scrollHeight;
        }

        function startMobilePractice() {
            document.getElementById('mobilePracticeArea').style.display = 'block';
            const practiceChart = echarts.init(document.getElementById('mobilePracticeChart'));
            const option = createChartOption('line', 100, true);
            practiceChart.setOption(option);
        }

        function testResponsive() {
            alert('Responsive test: Resize your browser window to see how the chart adapts to different screen sizes.');
        }

        function testTouch() {
            alert('Touch test: Try tapping, pinching, and swiping on the chart to test touch interactions.');
        }

        function testPerformance() {
            alert('Performance test: Check the performance metrics above and try different data sizes.');
        }

        function showMobileSolution() {
            alert('Mobile solution: Focus on responsive design, touch-friendly interactions, and performance optimization for the best mobile experience.');
        }

        // Handle window resize
        window.addEventListener('resize', function() {
            const charts = [
                document.getElementById('mobileChart'),
                document.getElementById('tabletChart'),
                document.getElementById('desktopChart'),
                document.getElementById('touchChart'),
                document.getElementById('performanceChart'),
                document.getElementById('mobileTooltipChart')
            ];
            
            charts.forEach(chart => {
                if (chart) {
                    echarts.getInstanceByDom(chart)?.resize();
                }
            });
        });
    </script>
</body>
</html>
